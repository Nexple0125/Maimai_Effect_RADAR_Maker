<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SDVX 스타일 이펙트 레이더 입력형</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
    body {
      font-family: 'Inter', sans-serif;
      background-color: #0d0d0d;
      color: #f0f0f0;
    }
    .container-card {
      background-color: #1a1a1a;
      box-shadow: 0 0 30px rgba(0,255,255,0.1);
      border: 1px solid #333;
    }
    #radarCanvas {
      border-radius: 12px;
      background-color: #1a1a1a;
      max-width: 100%;
      min-width: 350px;
      min-height: 350px;
    }
    .text-light { color: #f0f0f0; }
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input[type="number"] {
      -moz-appearance: textfield;
    }
  </style>
</head>
<body class="p-4 md:p-8 flex min-h-screen items-center justify-center">

  <div class="flex flex-row w-full max-w-screen-2xl gap-16 justify-between items-start">
    <!-- 입력부 (왼쪽) -->
    <div class="w-full max-w-md p-8 rounded-xl container-card">
      <h1 class="text-2xl font-bold text-light mb-2 text-center">EFFECT RADAR 입력</h1>
      <form id="inputForm" class="flex flex-col gap-3">
        <label class="flex flex-col gap-1">
          <span class="text-sm text-gray-300 font-medium">곡 제목</span>
          <input
            type="text"
            id="titleInput"
            value="氷滅の135小節"
            autocomplete="off"
            class="p-2 bg-gray-900 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-cyan-500 transition"
          />
        </label>
        <div class="grid grid-cols-2 gap-3">
          <label class="flex flex-col">
            <span class="text-xs text-cyan-400 font-semibold">Notes</span>
            <input type="number" id="Notes" min="0" max="150" step="0.1" value="112.5"
              class="p-2 bg-gray-800 border border-gray-600 rounded text-right" />
          </label>
          <label class="flex flex-col">
            <span class="text-xs text-cyan-400 font-semibold">Hand Speed</span>
            <input type="number" id="HandSpeed" min="0" max="150" step="0.1" value="120"
              class="p-2 bg-gray-800 border border-gray-600 rounded text-right" />
          </label>
          <label class="flex flex-col">
            <span class="text-xs text-cyan-400 font-semibold">Tricky</span>
            <input type="number" id="Tricky" min="0" max="150" step="0.1" value="50"
              class="p-2 bg-gray-800 border border-gray-600 rounded text-right" />
          </label>
          <label class="flex flex-col">
            <span class="text-xs text-cyan-400 font-semibold">Slide</span>
            <input type="number" id="Slide" min="0" max="150" step="0.1" value="57"
              class="p-2 bg-gray-800 border border-gray-600 rounded text-right" />
          </label>
          <label class="flex flex-col">
            <span class="text-xs text-cyan-400 font-semibold">Break</span>
            <input type="number" id="Break" min="0" max="150" step="0.1" value="135"
              class="p-2 bg-gray-800 border border-gray-600 rounded text-right" />
          </label>
          <label class="flex flex-col">
            <span class="text-xs text-cyan-400 font-semibold">Peak</span>
            <input type="number" id="Peak" min="0" max="150" step="0.1" value="110"
              class="p-2 bg-gray-800 border border-gray-600 rounded text-right" />
          </label>
        </div>
      </form>
    </div>
    <!-- 그래프/타이틀부 (오른쪽, 넓게) -->
    <div class="flex-1 flex flex-col items-center gap-2">
      <h2 id="songTitle" class="text-2xl font-bold text-light mb-4 text-center">EFFECT RADAR (氷滅の135小節)</h2>
      <canvas id="radarCanvas" width="1200" height="900" class="mt-2"></canvas>
      <button id="downloadBtn"
        class="mt-6 px-6 py-2 bg-cyan-600 hover:bg-cyan-700 text-white font-bold rounded shadow transition">
        그래프 저장 (PNG)
      </button>
    </div>
  </div>
  <script>
    // 색상 Lerp 함수
    function lerpColor(color1, color2, t) {
      const hexToRgb = hex => [parseInt(hex.slice(1,3),16), parseInt(hex.slice(3,5),16), parseInt(hex.slice(5,7),16)];
      const rgbToHex = (r,g,b) => '#' + ((1<<24)+(r<<16)+(g<<8)+b).toString(16).slice(1).toUpperCase().padStart(6,'0');
      const c1 = hexToRgb(color1), c2 = hexToRgb(color2);
      const r = Math.round(c1[0] + (c2[0]-c1[0]) * t);
      const g = Math.round(c1[1] + (c2[1]-c1[1]) * t);
      const b = Math.round(c1[2] + (c2[2]-c1[2]) * t);
      return rgbToHex(r,g,b);
    }

    function drawRadarChart(data, labels) {
      const canvas = document.getElementById('radarCanvas');
      const ctx = canvas.getContext('2d');
      const sizeW = canvas.width, sizeH = canvas.height;
      const centerX = sizeW / 2, centerY = sizeH / 2;
      const radius = Math.min(sizeW, sizeH) * 0.39;
      const threshold = 100, canvasScaleMax = 150, maxValRange = canvasScaleMax - threshold;
      const numAxes = labels.length, angleStep = 2 * Math.PI / numAxes;
      const primaryColor = '#00FFFF', highlightColor = '#FF00FF', axisColor = '#222222', thresholdColor = '#FFFFFF', gridColor = '#333333';
      ctx.clearRect(0,0,sizeW,sizeH);

      // 좌표 계산
      const points = data.map((value, i) => {
        const angle = i * angleStep - Math.PI/2;
        const r = (value / canvasScaleMax) * radius;
        return { x: centerX + r * Math.cos(angle), y: centerY + r * Math.sin(angle), value };
      });

      // 축 라인
      ctx.strokeStyle = axisColor; ctx.lineWidth = 1;
      for (let i=0;i<numAxes;i++) {
        const angle = i*angleStep - Math.PI/2;
        ctx.beginPath(); ctx.moveTo(centerX,centerY);
        ctx.lineTo(centerX+radius*Math.cos(angle), centerY+radius*Math.sin(angle)); ctx.stroke();
      }

      // 데이터 다각형 채우기
      const fillGradient = ctx.createRadialGradient(centerX,centerY,0,centerX,centerY,radius);
      const thresholdRatio = threshold/canvasScaleMax;
      fillGradient.addColorStop(0, primaryColor+'88'); fillGradient.addColorStop(thresholdRatio, primaryColor+'88'); fillGradient.addColorStop(1, highlightColor+'88');
      ctx.fillStyle = fillGradient;
      ctx.beginPath(); ctx.moveTo(points[0].x, points[0].y);
      for (let i=1;i<points.length;i++) ctx.lineTo(points[i].x,points[i].y);
      ctx.closePath(); ctx.fill();

      // 다각형 테두리 네온
      ctx.lineWidth = 3;
      const numSubSeg = 50;
      for (let i=0;i<numAxes;i++) {
        const p1=points[i], p2=points[(i+1)%numAxes];
        if (p1.value<=threshold && p2.value<=threshold){
          ctx.strokeStyle = primaryColor;
          ctx.beginPath(); ctx.moveTo(p1.x,p1.y); ctx.lineTo(p2.x,p2.y); ctx.stroke(); continue;
        }
        for (let j=0; j<numSubSeg; j++) {
          const t1 = j/numSubSeg, t2 = (j+1)/numSubSeg;
          const x1 = p1.x + (p2.x-p1.x)*t1, y1 = p1.y + (p2.y-p1.y)*t1;
          const x2 = p1.x + (p2.x-p1.x)*t2, y2 = p1.y + (p2.y-p1.y)*t2;
          let cVal = p1.value + (p2.value-p1.value)*(t1+t2)/2;
          let colorRatio = (cVal>threshold)?Math.min(1, (cVal-threshold)/maxValRange):0;
          ctx.strokeStyle = lerpColor(primaryColor, highlightColor, colorRatio);
          ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.stroke();
        }
      }

      // 그리드
      ctx.save();
      [50,100].forEach(score=>{
        ctx.beginPath();
        const r = (score/canvasScaleMax)*radius;
        for(let k=0;k<numAxes;k++) {
          const a = k*angleStep - Math.PI/2, x = centerX + r*Math.cos(a), y = centerY + r*Math.sin(a);
          k===0 ? ctx.moveTo(x,y) : ctx.lineTo(x,y);
        } ctx.closePath();
        if (score===threshold) {
          ctx.strokeStyle=thresholdColor; ctx.lineWidth=2; ctx.setLineDash([5,5]); ctx.shadowColor=thresholdColor; ctx.shadowBlur=10;
        } else {
          ctx.strokeStyle=gridColor; ctx.lineWidth=1; ctx.setLineDash([]); ctx.shadowColor=primaryColor; ctx.shadowBlur=3;
        } ctx.stroke();
      }); ctx.setLineDash([]); ctx.restore();

      // 점수 레이블
      ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
      ctx.fillStyle='#666'; ctx.font='16px Inter,sans-serif';
      [50,100].forEach(score=>{
        const r = (score/canvasScaleMax)*radius;
        ctx.fillText(score, centerX+9, centerY-r);
      });

      // 축 레이블 (폰트 25px, 거리 40px)
      ctx.font='25px Inter,sans-serif';
      const labelOffset = 40;
      for(let i=0;i<numAxes;i++) {
        const angle = i*angleStep-Math.PI/2;
        let textX=centerX+(radius+labelOffset)*Math.cos(angle), textY=centerY+(radius+labelOffset)*Math.sin(angle);
        ctx.textAlign=(Math.abs(Math.cos(angle))<.001)?'center':(Math.cos(angle)>0?'left':'right');
        ctx.textBaseline=(Math.abs(Math.sin(angle))<.001)?'middle':(Math.sin(angle)>0?'top':'bottom');
        const axisScore = data[i], axisColor = axisScore>threshold?highlightColor:primaryColor;
        ctx.save(); ctx.shadowColor=axisColor; ctx.fillStyle=axisColor; ctx.shadowBlur=14;
        ctx.fillText(labels[i], textX, textY); ctx.restore();
      }

      // 점 및 값
      const dotRadius = 6;
      points.forEach(pt=>{
        ctx.save();
        const ptColor = pt.value>threshold?highlightColor:primaryColor;
        ctx.shadowBlur=14; ctx.shadowColor=ptColor;
        ctx.beginPath(); ctx.arc(pt.x, pt.y, dotRadius, 0, 2*Math.PI);
        ctx.fillStyle=ptColor; ctx.strokeStyle='#FFF';
        ctx.fill(); ctx.lineWidth=2; ctx.stroke();
        ctx.restore();
        ctx.fillStyle=pt.value>threshold?highlightColor:'#f0f0f0';
        ctx.font=pt.value>threshold?'bold 20px Inter,sans-serif':'16px Inter,sans-serif';
        ctx.textAlign='center'; ctx.textBaseline='bottom';
        ctx.fillText(pt.value, pt.x, pt.y-18);
      });
    }

    // 폼 입력 이벤트 연결
    const labels = ['Notes','Hand Speed','Tricky','Slide','Break','Peak'];
    function getFormVals() {
      return [
        parseFloat(document.getElementById('Notes').value) || 0,
        parseFloat(document.getElementById('HandSpeed').value) || 0,
        parseFloat(document.getElementById('Tricky').value) || 0,
        parseFloat(document.getElementById('Slide').value) || 0,
        parseFloat(document.getElementById('Break').value) || 0,
        parseFloat(document.getElementById('Peak').value) || 0,
      ];
    }
    function updateRadar() {
      const vals = getFormVals();
      drawRadarChart(vals, labels);
      document.getElementById('songTitle').textContent =
        "EFFECT RADAR (" + (document.getElementById('titleInput').value || "Untitled") + ")";
    }
    document.querySelectorAll('#inputForm input').forEach(inp=>{
      inp.addEventListener('input', updateRadar);
    });
    window.addEventListener('DOMContentLoaded', updateRadar);
    window.addEventListener('resize', updateRadar);

    // PNG 다운로드 기능 추가
    document.getElementById('downloadBtn').addEventListener('click', function () {
      const canvas = document.getElementById('radarCanvas');
      const img = canvas.toDataURL('image/png');
      const link = document.createElement('a');
      const title = document.getElementById('titleInput').value || '';
      link.href = img;
      link.download = title ? `EffectRadar_${title}.png` : 'EffectRadar.png';
      document.body.appendChild(link); link.click(); document.body.removeChild(link);
    });

  </script>
</body>
</html>
